# BestPrice B2B Marketplace - Product Requirements Document

## –í–µ—Ä—Å–∏—è 3.0 (December 31, 2025)

## üéØ –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–ü–æ—Å—Ç—Ä–æ–∏—Ç—å B2B –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–∫—É–ø–æ–∫ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ —á–µ—Ä–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ª—É—á—à–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Å—Ä–µ–¥–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤.

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (Production Ready)

### 1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- ‚úÖ JWT-based authentication
- ‚úÖ 4 —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: Customer (–†–µ—Å—Ç–æ—Ä–∞–Ω-–∞–¥–º–∏–Ω), Chef (–ü–æ–≤–∞—Ä), Responsible (–ú–µ–Ω–µ–¥–∂–µ—Ä), Supplier (–ü–æ—Å—Ç–∞–≤—â–∏–∫)
- ‚úÖ Role-based access control (RBAC)
- ‚úÖ Team Management –¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤

### 2. –ö–∞—Ç–∞–ª–æ–≥ –∏ –ø–æ–∏—Å–∫
- ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ —Å 6,000+ —Ç–æ–≤–∞—Ä–∞–º–∏ –æ—Ç 9 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤
- ‚úÖ Fuzzy search —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –æ–ø–µ—á–∞—Ç–æ–∫ (Levenshtein distance)
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º, –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ –±—Ä–µ–Ω–¥–∞–º —á–µ—Ä–µ–∑ Brand Master Dictionary

### 3. –ò–∑–±—Ä–∞–Ω–Ω–æ–µ (Favorites)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
- ‚úÖ Drag & Drop –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ª—É—á—à–µ–π —Ü–µ–Ω—ã –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É
- ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å "–ë—Ä–µ–Ω–¥ –∫—Ä–∏—Ç–∏—á–µ–Ω" –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –±—Ä–µ–Ω–¥–∞

### 4. –ö–æ—Ä–∑–∏–Ω–∞ –∏ –∑–∞–∫–∞–∑—ã
- ‚úÖ –ú—É–ª—å—Ç–∏-–ø–æ—Å—Ç–∞–≤—â–∏–∫ –∫–æ—Ä–∑–∏–Ω–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤
- ‚úÖ –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤ (–Ω–æ–≤—ã–π, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω, –æ—Ç–∫–ª–æ–Ω–µ–Ω, —á–∞—Å—Ç–∏—á–Ω—ã–π)

### 5. Mobile App –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
- ‚úÖ –ú–æ–±–∏–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è Chef/Responsible
- ‚úÖ –ö–∞—Ç–∞–ª–æ–≥ –ø–æ–∑–∏—Ü–∏–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
- ‚úÖ –ë—ã—Å—Ç—Ä–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –ø–æ –Ω–æ–º–µ—Ä–∞–º –ø–æ–∑–∏—Ü–∏–π

### 6. Matrix Management
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤
- ‚úÖ 2 —Ä–µ–∂–∏–º–∞: "exact" (—Ç–æ—á–Ω—ã–π —Ç–æ–≤–∞—Ä) –∏ "cheapest" (–ø–æ–∏—Å–∫ –∞–Ω–∞–ª–æ–≥–∞)

### 7. –î–æ–∫—É–º–µ–Ω—Ç—ã –∏ –¥–æ–≥–æ–≤–æ—Ä—ã
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –º–µ–∂–¥—É —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º–∏ –∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º–∏
- ‚úÖ –°—Ç–∞—Ç—É—Å—ã –¥–æ–≥–æ–≤–æ—Ä–æ–≤ (–ø—Ä–∏–Ω—è—Ç, –æ–∂–∏–¥–∞–Ω–∏–µ, –æ—Ç–∫–ª–æ–Ω–µ–Ω)

## üöÄ –¢–ï–ö–£–©–ê–Ø –ó–ê–î–ê–ß–ê: –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ "–õ—É—á—à–∞—è —Ü–µ–Ω–∞"

### –ö–æ–Ω—Ç–µ–∫—Å—Ç
–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ –∏–∑ –ò–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –≤ –∫–æ—Ä–∑–∏–Ω—É, —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–π—Ç–∏ –ª—É—á—à–µ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ —Å —É—á–µ—Ç–æ–º –±—Ä–µ–Ω–¥–∞ –∏ —Ñ–∞—Å–æ–≤–∫–∏.

### –ü—Ä–æ–±–ª–µ–º—ã (–¥–æ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏)
1. **–•–∞–æ—Å –≤ –ò–∑–±—Ä–∞–Ω–Ω–æ–º**: –°—Ç–∞—Ä—ã–µ favorites –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö ‚Üí –ø–∞–¥–∞–µ—Ç –ø–æ–∏—Å–∫ –∏–ª–∏ –±–µ—Ä–µ—Ç—Å—è –Ω–µ –ª—É—á—à–∏–π –æ—Ñ—Ñ–µ—Ä
2. **Brand Critical –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**: –£ supplier_items brand_id = null ‚Üí —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –±—Ä–µ–Ω–¥—É –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
3. **–ö—Ä–æ—Å—Å-–∫–∞—Ç–µ–≥–æ—Ä–∏–π–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è**: "–ª–æ—Å–æ—Å—å" –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å "–∫—É—Ä–∏—Ü–∞", "–∫–µ—Ç—á—É–ø" ‚Üí "–≤–æ–¥–∞"
4. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–∞—Å–æ–≤–∫–∏**: –ö–µ—Ç—á—É–ø 2–∫–≥ ‚Üí 25ml dip-pot (96.9% difference)
5. **–ù–µ—Ç –ø–æ—Ä–æ–≥–æ–≤ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è**: –ú–∞—Ç—á–∞—Ç—Å—è —Ç–æ–≤–∞—Ä—ã —Å –Ω–∏–∑–∫–∏–º score

### –†–µ—à–µ–Ω–∏–µ (Final Stabilization Plan)

#### 1. –ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç Favorite v2
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ favorite_v2:**
```javascript
{
  favorite_id: string,
  reference_name: string,       // –≠—Ç–∞–ª–æ–Ω–Ω–æ–µ –∏–º—è
  brand_id: string | null,      // ID –±—Ä–µ–Ω–¥–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å null)
  brand_critical: boolean,      // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é false
  unit_norm: string,            // 'kg' | 'l' | 'pcs'
  pack_size: number,            // –ß–∏—Å–ª–æ –≤ unit_norm
  tokens_norm: string[],        // –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã
  schema_version: 2             // –í–µ—Ä—Å–∏—è —Å—Ö–µ–º—ã
}
```

**–ü—Ä–∞–≤–∏–ª–∞:**
- –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É" –≤—ã–∑—ã–≤–∞–µ—Ç: `select_best_offer(reference_item)` ‚Üí `add_to_cart(supplier_item_id, qty)`
- Matching –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å null-safe: —Å—Ç–∞—Ç—É—Å—ã `not_found`, `insufficient_data`, `ok` (–ù–ï 500)

#### 2. Brand Backfill (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
**–ü—Ä–æ–±–ª–µ–º–∞:** –£ supplier_items brand_id = null
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü–æ—Å–ª–µ –∑–∞–º–µ–Ω—ã —Ñ–∞–π–ª–∞ –±—Ä–µ–Ω–¥–æ–≤ –∑–∞–ø—É—Å—Ç–∏—Ç—å brand backfill
2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –±—Ä–µ–Ω–¥ –ø–æ –∞–ª–∏–∞—Å–∞–º –∏–∑ BESTPRICE_BRANDS_MASTER_UNIFIED_RF_HORECA_ULTRA_SAFE.xlsx
3. –ó–∞–ø–∏—Å–∞—Ç—å brand_id –≤ –∫–∞–∂–¥—ã–π supplier_item
4. –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤–∫–ª—é—á–∞—Ç—å brand_critical

**Endpoint:** `/admin/brands/backfill` (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)

#### 3. –õ–æ–≥–∏–∫–∞ Brand Critical (—Å—Ç—Ä–æ–≥–∞—è)
**–ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å:** brand_critical –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é OFF

**–ï—Å–ª–∏ brand_critical = ON:**
- –í matching —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –¢–û–õ–¨–ö–û supplier_items —Å —Ç–µ–º –∂–µ brand_id
- –ï—Å–ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ—Ç ‚Üí "–Ω–µ –Ω–∞–π–¥–µ–Ω–æ" (–±–µ–∑ fallback)
- –ü–æ—Ä–æ–≥ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è: **‚â• 85%**

**–ï—Å–ª–∏ brand_critical = OFF:**
- –ë—Ä–µ–Ω–¥ –ü–û–õ–ù–û–°–¢–¨–Æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
- –ó–∞–ø—Ä–µ—â–µ–Ω–æ "–ø—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å—Å—è" –∫ –±—Ä–µ–Ω–¥—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –ü—Ä–∏–º–µ—Ä: Heinz ‚Üí Mutti –¥–æ–ø—É—Å—Ç–∏–º–æ
- –ü–æ—Ä–æ–≥ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è: **‚â• 70%**

#### 4. Matching + –ø–æ—Ä–æ–≥–∏ (–∑–∞—â–∏—Ç–∞ –æ—Ç –∫—Ä–æ—Å—Å-–∫–∞—Ç–µ–≥–æ—Ä–∏–π)
**–ü–æ—Ä–æ–≥–∏:**
- Brand critical = ON: `score >= 0.85` (85%)
- Brand critical = OFF: `score >= 0.70` (70%)

**–ó–∞—â–∏—Ç–∞:**
1. –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã (—Å–ª–æ–≤–∞—Ä—å –±—Ä–µ–Ω–¥–æ–≤ + —Å—Ç–æ–ø-—Å–ª–æ–≤–∞)
2. –í—ã–¥–µ–ª—è—Ç—å "—Ç–∏–ø —Ç–æ–≤–∞—Ä–∞/—è–¥—Ä–æ" (–∫–µ—Ç—á—É–ø, –ª–æ—Å–æ—Å—å, —è–≥–Ω—è—Ç–∏–Ω–∞)
3. –ù–µ –¥–∞–≤–∞—Ç—å –º–∞—Ç—á–∏—Ç—å —Ä–∞–∑–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
   - –∫–µ—Ç—á—É–ø ‚â† –≤–æ–¥–∞
   - –ª–æ—Å–æ—Å—å ‚â† –∫—É—Ä–∏—Ü–∞
   - –º–∞—Å–ª–æ ‚â† –º–∞—Ä–≥–∞—Ä–∏–Ω

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** Guard rules –≤ `search_engine.py` (—É–∂–µ –µ—Å—Ç—å)

#### 5. –§–∞—Å–æ–≤–∫–∞ x2 + –≤—ã–±–æ—Ä –ø–æ Total Cost
**–ü—Ä–∞–≤–∏–ª–æ —Ñ–∞—Å–æ–≤–∫–∏:**
```
candidate_pack_size <= reference_pack_size * 2
candidate_pack_size >= reference_pack_size * 0.5
```

**–ï–¥–∏–Ω–∏—Ü—ã:** –ù–µ–ª—å–∑—è —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å kg –∏ l (—Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π unit_norm)

**–ì–∏–±—Ä–∏–¥–Ω—ã–π –≤—ã–±–æ—Ä:**
1. `unit_price = price / pack_size` (‚ÇΩ/kg –∏–ª–∏ ‚ÇΩ/l)
2. `cost_for_reference_volume = unit_price * reference_pack_size`
3. –í—ã–±–∏—Ä–∞—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏:
   - `cost_for_reference_volume < cost_of_best_exact_match`
4. –ï—Å–ª–∏ —Ç–æ—á–Ω–æ–π —Ñ–∞—Å–æ–≤–∫–∏ –Ω–µ—Ç ‚Üí –≤—ã–±–∏—Ä–∞–µ–º min `cost_for_reference_volume` —Å—Ä–µ–¥–∏:
   - –¢–æ–≥–æ –∂–µ "—Ç–∏–ø–∞ —Ç–æ–≤–∞—Ä–∞"
   - –ü–æ—Ä–æ–≥ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Å–æ–±–ª—é–¥—ë–Ω
   - –§–∞—Å–æ–≤–∫–∞ ‚â§ x2

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `search_engine.py` –ª–∏–Ω–∏–∏ 484-511 (—É–∂–µ –µ—Å—Ç—å)

#### 6. –í—ã–±–æ—Ä —Å—Ä–µ–¥–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ (—É—Å—Ç–æ–π—á–∏–≤—ã–π –ø–æ—Ä—è–¥–æ–∫)
**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –ø–æ:
   - brand_critical –ø—Ä–∞–≤–∏–ª–∞–º
   - unit_norm
   - —Ñ–∞—Å–æ–≤–∫–∞ ‚â§ x2
   - score >= threshold
2. –°—Ä–µ–¥–∏ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –≤—ã–±—Ä–∞—Ç—å:
   ```
   min(cost_for_reference_volume)
   ```

**–≠—Ç–æ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç:** "—Å–∏–±–∞—Å 990‚ÇΩ –Ω–µ –æ—Å—Ç–∞–≤–∞–ª—Å—è 990‚ÇΩ" (—Ç–µ–ø–µ—Ä—å –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –¥–µ—à–µ–≤–ª–µ)

#### 7. UI –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü–æ–ø–∞–ø: —Ç–æ–≤–∞—Ä + —Ü–µ–Ω–∞ + –ø–æ—Å—Ç–∞–≤—â–∏–∫ + % —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
- –ï—Å–ª–∏ score < threshold ‚Üí –ù–ï –¥–æ–±–∞–≤–ª—è—Ç—å, –ø–æ–∫–∞–∑–∞—Ç—å "–Ω–µ –Ω–∞–π–¥–µ–Ω–æ (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è)"

## üß™ –¢–µ—Å—Ç—ã (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏)

### –¢–µ—Å—Ç 1: –ò–∑–±—Ä–∞–Ω–Ω–æ–µ —Å—Ç–∞—Ä–æ–µ/–Ω–æ–≤–æ–µ
1. –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å—Ç–∞—Ä—ã–µ favorites
2. –°–æ–∑–¥–∞—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ (20 items)
3. –ù–∞–∂–∞—Ç—å "–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É" –Ω–∞ 10 —Ä–∞–∑–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–∫–∞—Ö
‚úÖ **–û–∂–∏–¥–∞–µ–º–æ–µ:** –ù–µ—Ç –æ—à–∏–±–æ–∫, –≤—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è supplier_item_id —Å —Ü–µ–Ω–æ–π

### –¢–µ—Å—Ç 2: –ë—Ä–µ–Ω–¥ –∫—Ä–∏—Ç–∏—á–µ–Ω ON
- –ü—Ä–∏–º–µ—Ä: "–ö–µ—Ç—á—É–ø Heinz 0.8" —Å brand_critical=ON
‚úÖ **–û–∂–∏–¥–∞–µ–º–æ–µ:** –í—ã–±–∏—Ä–∞–µ—Ç—Å—è —Å–∞–º—ã–π –¥–µ—à—ë–≤—ã–π Heinz
‚ùå –ï—Å–ª–∏ Heinz –Ω–µ—Ç ‚Üí "–Ω–µ –Ω–∞–π–¥–µ–Ω–æ" (–Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å)

### –¢–µ—Å—Ç 3: –ë—Ä–µ–Ω–¥ –Ω–µ–≤–∞–∂–µ–Ω OFF
- –ü—Ä–∏–º–µ—Ä: "–ö–µ—Ç—á—É–ø Heinz 0.8" —Å brand_critical=OFF
‚úÖ **–û–∂–∏–¥–∞–µ–º–æ–µ:** –ú–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å Mutti/–¥—Ä—É–≥–æ–π –±—Ä–µ–Ω–¥ –µ—Å–ª–∏:
  - score ‚â• 70%
  - unit_norm —Å–æ–≤–ø–∞–¥–∞–µ—Ç
  - —Ñ–∞—Å–æ–≤–∫–∞ ‚â§ x2
  - –ø–µ—Ä–µ—Å—á—ë—Ç –¥–µ—à–µ–≤–ª–µ

### –¢–µ—Å—Ç 4: –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –î–æ–±–∞–≤–ª—è–µ–º "–õ–æ—Å–æ—Å—å" / "–Ø–≥–Ω—è—Ç–∏–Ω–∞" / "–ö–µ—Ç—á—É–ø"
‚úÖ **–û–∂–∏–¥–∞–µ–º–æ–µ:** –ª–æ—Å–æ—Å—å ‚â† –∫—É—Ä–∏—Ü–∞, –∫–µ—Ç—á—É–ø ‚â† –≤–æ–¥–∞

### –¢–µ—Å—Ç 5: Brand backfill
1. –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤—ã–π —Ñ–∞–π–ª –±—Ä–µ–Ω–¥–æ–≤
2. –ó–∞–ø—É—Å–∫–∞–µ–º brand backfill
3. –ü—Ä–æ–≤–µ—Ä—è–µ–º brand_critical=ON –Ω–∞ 5 —Ç–æ–≤–∞—Ä–∞—Ö
‚úÖ **–û–∂–∏–¥–∞–µ–º–æ–µ:** –ë—Ä–µ–Ω–¥-–∫—Ä–∏—Ç–∏—á–Ω—ã–π –ø–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### Backend (FastAPI)
```
/app/backend/
‚îú‚îÄ‚îÄ server.py                   # Monolithic FastAPI app (API routers)
‚îú‚îÄ‚îÄ search_engine.py            # üî• Enhanced Search Engine (v2.0)
‚îú‚îÄ‚îÄ brand_master.py             # Brand Master Dictionary
‚îú‚îÄ‚îÄ backfill_brands.py          # Brand backfill script
‚îú‚îÄ‚îÄ order_optimizer.py          # Order optimization logic
‚îî‚îÄ‚îÄ BESTPRICE_BRANDS_MASTER_UNIFIED_RF_HORECA_ULTRA_SAFE.xlsx
```

### Frontend (React)
```
/app/frontend/src/pages/
‚îú‚îÄ‚îÄ customer/
‚îÇ   ‚îú‚îÄ‚îÄ CustomerCatalog.js      # –ö–∞—Ç–∞–ª–æ–≥ —Å fuzzy search
‚îÇ   ‚îú‚îÄ‚îÄ CustomerFavorites.js    # üî• –ò–∑–±—Ä–∞–Ω–Ω–æ–µ —Å Best Price
‚îÇ   ‚îú‚îÄ‚îÄ CustomerCart.js         # –ö–æ—Ä–∑–∏–Ω–∞
‚îÇ   ‚îî‚îÄ‚îÄ CustomerOrders.js       # –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤
‚îú‚îÄ‚îÄ chef/
‚îÇ   ‚îî‚îÄ‚îÄ ChefMatrix.js           # Matrix ordering
‚îî‚îÄ‚îÄ mobile/
    ‚îú‚îÄ‚îÄ MobileLogin.js
    ‚îú‚îÄ‚îÄ MobileHome.js
    ‚îî‚îÄ‚îÄ MobileOrderCreate.js
```

### Database (MongoDB)
**Collections:**
- `users` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (4 —Ä–æ–ª–∏)
- `companies` - –ö–æ–º–ø–∞–Ω–∏–∏ (—Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã + –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏)
- `favorites` - üî• –ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã (schema v2)
- `pricelists` - –ü—Ä–∞–π—Å–ª–∏—Å—Ç—ã –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ (8,233 items)
- `products` - –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥
- `orders` - –ó–∞–∫–∞–∑—ã
- `matrices` - –ú–∞—Ç—Ä–∏—Ü—ã –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- `cart` - –ö–æ—Ä–∑–∏–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üîë Key Technical Concepts

### 1. Two-Phase Search (Strict/Rescue)
–ê–ª–≥–æ—Ä–∏—Ç–º, –∫–æ—Ç–æ—Ä—ã–π —Å–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ—Ç—Å—è strict search, –ø–æ—Ç–æ–º rescue —Å penalties.

### 2. Brand Family Logic
–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ sub-brands –ø–æ–¥ parent brand:
- "Miratorg Chef" ‚Üí "Miratorg"
- "Hochland Professional" ‚Üí "Hochland"

### 3. Economic Matching
–í—ã–±–æ—Ä –ø–æ total_cost –¥–ª—è —Ç—Ä–µ–±—É–µ–º–æ–≥–æ –æ–±—ä—ë–º–∞, –Ω–µ –ø—Ä–æ—Å—Ç–æ unit price.

### 4. Dynamic Packaging Rules
–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É 0.5x - 2x –æ—Ç —ç—Ç–∞–ª–æ–Ω–Ω–æ–π —Ñ–∞—Å–æ–≤–∫–∏.

### 5. Guard Rules
–ó–∞—â–∏—Ç–∞ –æ—Ç –∫—Ä–æ—Å—Å-–∫–∞—Ç–µ–≥–æ—Ä–∏–π–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π:
```python
GUARD_CONFLICTS = {
    '–∫–µ—Ç—á—É–ø': {'—Å–æ—É—Å', '–ø–∞—Å—Ç–∞', '–º–∞–π–æ–Ω–µ–∑'},
    '—Å–æ—É—Å': {'–∫–µ—Ç—á—É–ø', '–ø–∞—Å—Ç–∞'},
    '–º–∞—Å–ª–æ': {'–º–∞—Ä–≥–∞—Ä–∏–Ω', '—Å–ø—Ä–µ–¥'},
    '–º–æ–ª–æ–∫–æ': {'—Å–ª–∏–≤–∫–∏', '–∫–µ—Ñ–∏—Ä', '–π–æ–≥—É—Ä—Ç'},
}
```

## üöß Upcoming Tasks (–ø–æ—Å–ª–µ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏)

### P1: Order Creation Flow
- –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è `/api/favorites/order`
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `order_optimizer.py`

### P2: Telegram Bot Integration
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –∑–∞–∫–∞–∑–æ–≤
- –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∞

### P3: Advanced User Permissions
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- Custom roles

### P4: Analytics Dashboard
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —ç–∫–æ–Ω–æ–º–∏–∏
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º

## üìà –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:** 40+ (4 —Ä–æ–ª–∏)
- **–¢–æ–≤–∞—Ä—ã:** 6,000+
- **–ü–æ—Å—Ç–∞–≤—â–∏–∫–∏:** 9
- **–ó–∞–∫–∞–∑—ã:** 38+
- **–≠–∫–æ–Ω–æ–º–∏—è:** 15-20% –ø–æ –∏—Ç–æ–≥–∞–º testing

### –¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ (–ø–æ—Å–ª–µ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏)
- **–¢–æ—á–Ω–æ—Å—Ç—å matching:** ‚â• 95%
- **False positives:** < 2%
- **–°–∫–æ—Ä–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞:** < 200ms
- **Null-safety:** 100% (–±–µ–∑ 500 –æ—à–∏–±–æ–∫)

## üîó Key API Endpoints

### Favorites & Cart
- `POST /api/favorites` - –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
- `GET /api/favorites` - –ü–æ–ª—É—á–∏—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
- `POST /api/cart/add-from-favorite` - üî• –î–æ–±–∞–≤–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –≤ –∫–æ—Ä–∑–∏–Ω—É (Best Price)
- `POST /api/cart/select-offer` - –í—ã–±—Ä–∞—Ç—å –ª—É—á—à–µ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ

### Admin & Brand Management
- `POST /admin/brands/backfill` - üî• Brand backfill
- `POST /admin/search/quality-report` - –û—Ç—á–µ—Ç –ø–æ –ø–æ–∫—Ä—ã—Ç–∏—é –±—Ä–µ–Ω–¥–æ–≤
- `POST /admin/fixtures/create` - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

### Testing
- `POST /api/tests/run-all` - –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã

## üé® Design Guidelines

### Text Size Hierarchy
- H1 (Main Heading): `text-4xl sm:text-5xl lg:text-6xl`
- H2 (Subheading): `text-base md:text-lg`
- Body: `text-base` (mobile: `text-sm`)
- Small/Accent: `text-sm` or `text-xs`

### Colors
- Primary: Blue (#3B82F6)
- Success: Green (#10B981)
- Warning: Yellow (#F59E0B)
- Danger: Red (#EF4444)

## üìù Notes for Next Agent

### Critical Info
1. **Follow user spec (message #288)**: This is the final PRD
2. **Use test endpoints**: `/admin/fixtures/create` and `/api/tests/run-all`
3. **Logic in search_engine.py**: All matching logic goes here
4. **Data is volatile**: Be ready to wipe and reseed
5. **Brand file updated**: BESTPRICE_BRANDS_MASTER_UNIFIED_RF_HORECA_ULTRA_SAFE.xlsx

### Previous Agent Mistakes
- None recorded (systematic completion of tasks)

### Testing Credentials
- **Customer (Admin):** `customer@bestprice.ru` / `password123`
- **Chef:** `chef@bestprice.ru` / `password123`
- **Staff (Responsible):** `staff@bestprice.ru` / `password123`
- **Supplier:** `ifruit@bestprice.ru` / `password123`

---

**Document Version:** 3.0
**Last Updated:** December 31, 2025
**Status:** üî• In Progress - Final Stabilization
