# ОТЧЁТ: Двойной алгоритм классификации товаров

**Дата:** 2026-01-10  
**Версия:** 1.0  
**Статус:** ✅ Выполнено

---

## 1. ОБЗОР

Была разработана и применена система двойного алгоритма для определения категорий ВСЕХ товаров в базе данных.

### Результаты

| Метрика | До | После | Изменение |
|---------|-----|-------|-----------|
| Покрытие классификации | 95.8% | **97.8%** | +2.0% |
| Неклассифицированных | 329 | **171** | -158 |
| Категорий | ~30 | **45+** | +15 |

---

## 2. ДВОЙНОЙ АЛГОРИТМ

### Алгоритм 1: Rule-based (Детерминистический)

**Принцип:** Иерархические правила по ключевым словам с приоритетами.

```
УРОВЕНЬ 1 (95% confidence): Специфичные товары
├── packaging.cutlery: [нож пластик, вилка пластик, ложка пластик]
├── seafood.langoustine: [лангустин, креветки аргентин]
├── ready_meals.cheburek: [чебурек, чебурёк]
└── condiments.miso: [мисо паста, shiro miso]

УРОВЕНЬ 2 (85% confidence): Категории продуктов
├── dairy.cheese: [сыр, cheese, моцарелл, пармезан]
├── meat.chicken: [курин, курица, chicken, цыплён]
├── seafood.shrimp: [креветк, shrimp, prawn]
└── ...

УРОВЕНЬ 3 (70% confidence): Общие категории
├── meat: [мясо, фарш, котлет, стейк]
├── seafood: [морепродукт, рыба, fish]
└── ...
```

**Особенности:**
- Негативный контекст для исключения ложных срабатываний
- Приоритет более специфичных правил над общими
- 150+ правил в трёх уровнях приоритета

### Алгоритм 2: Fuzzy-matching (Вероятностный)

**Принцип:** Нечёткое сопоставление с уже классифицированными товарами.

```python
# Используется rapidfuzz.token_set_ratio
best_match = process.extractOne(
    name, 
    existing_items,
    scorer=fuzz.token_set_ratio,
    score_cutoff=70
)
```

**Особенности:**
- Нормализация синонимов (с/м → свежемороженый)
- Контекстный анализ (frozen, fresh, premium)
- Использование уже классифицированных товаров как эталонов

### Ensemble (Комбинация)

```
IF rule_conf >= 85%:
    → Используем rule-based
ELIF fuzzy_conf >= 85% AND rule = 'other':
    → Используем fuzzy
ELIF rule = fuzzy AND rule != 'other':
    → Ensemble (бонус +5% за согласие)
ELSE:
    → Выбираем алгоритм с большей confidence
```

---

## 3. РЕЗУЛЬТАТЫ КЛАССИФИКАЦИИ

### Распределение по категориям верхнего уровня

| Категория | Количество | Процент |
|-----------|------------|---------|
| condiments | 1163 | 15.0% |
| meat | 925 | 12.0% |
| dairy | 764 | 9.9% |
| beverages | 599 | 7.7% |
| vegetables | 575 | 7.4% |
| staples | 511 | 6.6% |
| seafood | 467 | 6.0% |
| canned | 446 | 5.8% |
| fruits | 439 | 5.7% |
| ready_meals | 410 | 5.3% |
| bakery | 326 | 4.2% |
| packaging | 296 | 3.8% |
| pasta | 232 | 3.0% |
| frozen | 185 | 2.4% |
| non_food | 13 | 0.2% |
| ... | ... | ... |

### Новые категории (добавлены)

```
packaging.cutlery      # Столовые приборы
packaging.container    # Контейнеры
packaging.skewer       # Шампуры
seafood.fish_sticks    # Рыбные палочки
seafood.langoustine    # Лангустины
ready_meals.cheburek   # Чебуреки
meat.prosciutto        # Прошутто/хамон
condiments.miso        # Мисо паста
condiments.curry_paste # Паста карри
condiments.topping     # Топпинги
non_food.wrap          # Плёнка, фольга
non_food.paper         # Бумажные изделия
non_food.uniform       # Спецодежда
meat.rabbit            # Кролик
desserts.boba          # Тапиока/боба
```

---

## 4. НЕКЛАССИФИЦИРОВАННЫЕ (171 товар)

Оставшиеся 2.2% - это преимущественно:

1. **Non-food расходники** (туалетная бумага, шапочки, и т.д.)
2. **Очень короткие названия** (Бакалея, Маш вес)
3. **Уникальные товары** (Виноградные листья)
4. **Некорректные записи** (опечатки, неполные данные)

### Рекомендации для полного покрытия

1. Добавить правила для non-food категорий:
   - `non_food.hygiene` (туалетная бумага)
   - `non_food.headwear` (шапочки)
   
2. Ручная разметка уникальных товаров

3. Запросить у поставщиков корректные названия

---

## 5. ФАЙЛЫ И АРТЕФАКТЫ

| Файл | Описание |
|------|----------|
| `/app/backend/full_classification_engine.py` | Движок двойной классификации |
| `/app/test_reports/classification_report.json` | Детальный отчёт |
| `/app/test_reports/final_classification_report.json` | Финальная статистика |

---

## 6. ВЫВОДЫ

✅ **Успешно реализован двойной алгоритм классификации:**
- Rule-based для точных совпадений (72.4% товаров)
- Fuzzy-matching для нечётких (27.6% товаров)

✅ **Покрытие увеличено с 95.8% до 97.8%**

✅ **Добавлено 15+ новых категорий** включая non-food

✅ **Алгоритм готов к использованию** в BestPrice matching

---

*Отчёт подготовлен автоматически системой классификации*
